<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>gathurUP Notification Test</title>
    <link rel="icon" href="gathurup.ico" type="image/x-icon">
    <link rel="stylesheet" href="styles_vote.css">
    <link rel="manifest" href="manifest.webmanifest">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="gathurUP">
    <link rel="apple-touch-icon" href="icon-192.png">
    <style>
        .notification-container {
            max-width: 600px;
            margin: 40px auto;
            padding: 20px;
        }

        .status-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border: 1px solid var(--border-color);
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .status-success {
            background-color: var(--green);
        }

        .status-pending {
            background-color: var(--yellow);
        }

        .status-error {
            background-color: var(--red);
        }

        .test-button {
            background: var(--tiffany-blue);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        #permissionStatus {
            margin-top: 20px;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }

        .granted {
            background-color: var(--green);
            color: white;
        }

        .denied {
            background-color: var(--red);
            color: white;
        }

        .platform-info {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="notification-container">
        <div class="platform-info" id="platformInfo"></div>
        <div class="status-card">
            <div class="status-item">
                <div class="status-indicator status-success"></div>
                <span>Notification 1</span>
            </div>
            <div class="status-item">
                <div class="status-indicator status-pending"></div>
                <span>Notification 2</span>
            </div>
            <div class="status-item">
                <div class="status-indicator status-error"></div>
                <span>Notification 3</span>
            </div>
        </div>
        <button class="test-button" onclick="requestAndShowNotification()">Test Notification</button>
        <div id="permissionStatus"></div>
    </div>

    <script>
        // Add this at the start of your script section
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registered:', registration);
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }

        function detectPlatform() {
            const platformInfo = document.getElementById('platformInfo');
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const isPWA = window.matchMedia('(display-mode: standalone)').matches;
            
            if (isIOS) {
                platformInfo.innerHTML = `
                    ℹ��� iOS Detected: To enable notifications:
                    <br>1. Tap Share button in Safari
                    <br>2. Select "Add to Home Screen"
                    <br>3. Open gathurUP from home screen
                    <br>
                    <br>Note: iOS notifications are limited even in PWA mode
                `;
            } else if (isMobile && !isPWA) {
                platformInfo.innerHTML = `
                    ⚠️ Mobile browser detected. For notifications:
                    <br>1. Install as PWA (Add to Home Screen)
                    <br>2. Reopen from home screen
                `;
            } else {
                platformInfo.innerHTML = `
                    ✅ You're on ${isPWA ? 'PWA' : 'desktop'}. Notifications should work after permission.
                `;
            }
        }

        // Check platform and notification permission on page load
        document.addEventListener('DOMContentLoaded', () => {
            detectPlatform();
            checkNotificationPermission();
        });

        function checkNotificationPermission() {
            const status = document.getElementById('permissionStatus');
            if (!("Notification" in window)) {
                status.textContent = "This browser does not support notifications";
                status.className = "denied";
                return;
            }

            status.textContent = `Notification permission: ${Notification.permission}`;
            status.className = Notification.permission === 'granted' ? 'granted' : 'denied';
        }

        async function requestAndShowNotification() {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            
            if (isIOS && !window.matchMedia('(display-mode: standalone)').matches) {
                alert("Please install this app to your home screen first for notifications to work.");
                return;
            }
            
            if (!("Notification" in window)) {
                alert("This browser does not support notifications");
                return;
            }

            try {
                let permission = Notification.permission;

                if (permission === "default") {
                    permission = await Notification.requestPermission();
                }

                if (permission === "granted") {
                    const notification = new Notification("gathurUP Notification", {
                        body: "This is a test notification from gathurUP!",
                        icon: "gathurup.ico",
                        tag: "test-notification",
                        timestamp: Date.now()
                    });

                    notification.onclick = function() {
                        window.focus();
                        notification.close();
                    };
                }
            } catch (error) {
                console.error("Notification error:", error);
                alert("Error showing notification: " + error.message);
            }

            checkNotificationPermission();
        }
    </script>
</body>
</html>